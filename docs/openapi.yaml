openapi: 3.0.0
info:
  title: Quantix Personal Finance Manager API
  description: API for managing personal finances including transactions, credit cards, categories, and recurring payments
  version: 1.0.0
  contact:
    name: Quantix Support
    email: support@quantix.example.com

servers:
  - url: https://api.quantix.example.com
    description: Production server
  - url: https://staging.quantix.example.com
    description: Staging server

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: API-KEY
      description: API key for authentication, configured via QUANTIX_API_KEY environment variable

  schemas:
    Category:
      type: object
      required:
        - name
        - type
      properties:
        id:
          type: string
          description: Unique identifier for the category
          example: "cat_123456789"
        name:
          type: string
          description: Name of the category
          example: "Groceries"
        type:
          type: string
          enum: [INCOME, EXPENSE]
          description: Type of the category
          example: "EXPENSE"
        color:
          type: string
          nullable: true
          description: Color for the category in hexadecimal format
          example: "#FF5733"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the category was created
          example: "2026-01-30T10:00:00Z"

    Transaction:
      type: object
      required:
        - type
        - name
        - amount
        - date
      properties:
        id:
          type: string
          description: Unique identifier for the transaction
          example: "txn_123456789"
        type:
          type: string
          enum: [INCOME, EXPENSE]
          description: Type of the transaction
          example: "EXPENSE"
        name:
          type: string
          description: Description of the transaction
          example: "Weekly groceries"
        amount:
          type: number
          format: float
          minimum: 0
          description: Amount of the transaction
          example: 125.75
        date:
          type: string
          format: date
          description: Date of the transaction
          example: "2026-01-30"
        purchaseDate:
          type: string
          format: date
          description: Actual purchase date (credit card only, optional)
          example: "2026-02-10"
          nullable: true
        categoryId:
          type: string
          description: ID of the associated category
          example: "cat_123456789"
        category:
          $ref: '#/components/schemas/Category'
          description: Associated category object
        paymentMethod:
          type: string
          enum: [CASH, PIX, DEBIT, CREDIT]
          description: Method of payment
          example: "CREDIT"
        creditCardId:
          type: string
          description: ID of the associated credit card (required if paymentMethod is CREDIT)
          example: "cc_123456789"
        creditCard:
          $ref: '#/components/schemas/CreditCard'
          description: Associated credit card object
        installmentGroupId:
          type: string
          description: ID to group installment transactions
          example: "ig_123456789"
        installmentNumber:
          type: integer
          minimum: 1
          description: Current installment number in a series
          example: 2
        installmentTotal:
          type: integer
          minimum: 1
          description: Total number of installments in the series
          example: 5
        recurrenceRuleId:
          type: string
          description: ID of the associated recurrence rule
          example: "rr_123456789"
        accountId:
          type: string
          description: ID of the associated account (required if paymentMethod is not CREDIT)
          example: "acc_123456789"
        account:
          $ref: '#/components/schemas/Account'
          description: Associated account object
        paid:
          type: boolean
          default: false
          description: Whether the transaction has been paid/received
          example: true
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the transaction was created
          example: "2026-01-30T10:00:00Z"

    CreditCard:
      type: object
      required:
        - name
        - limitAmount
        - closingDay
        - dueDay
      properties:
        id:
          type: string
          description: Unique identifier for the credit card
          example: "cc_123456789"
        name:
          type: string
          description: Name of the credit card
          example: "Nubank Platinum"
        brand:
          type: string
          description: Brand of the credit card
          example: "Visa"
        limitAmount:
          type: number
          format: float
          minimum: 0
          description: Credit limit of the card
          example: 5000.00
        closingDay:
          type: integer
          minimum: 1
          maximum: 31
          description: Day of the month when the billing cycle closes
          example: 15
        dueDay:
          type: integer
          minimum: 1
          maximum: 31
          description: Day of the month when the bill is due
          example: 22
        availableLimit:
          type: number
          format: float
          description: Available credit limit (limitAmount minus all pending unpaid expenses)
          example: 3200.00
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the credit card was added
          example: "2026-01-30T10:00:00Z"

    RecurrenceRule:
      type: object
      required:
        - frequency
      properties:
        id:
          type: string
          description: Unique identifier for the recurrence rule
          example: "rr_123456789"
        frequency:
          type: string
          enum: [MONTHLY, WEEKLY, YEARLY]
          description: Frequency of recurrence
          example: "MONTHLY"
        interval:
          type: integer
          minimum: 1
          default: 1
          description: Interval multiplier for the frequency
          example: 1
        endDate:
          type: string
          format: date
          description: Date when the recurrence should end (mutually exclusive with occurrences)
          example: "2026-12-31"
        occurrences:
          type: integer
          minimum: 2
          description: Number of occurrences (mutually exclusive with endDate). When set, transaction names will be formatted as "Name (N/total)"
          example: 12
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the recurrence rule was created
          example: "2026-01-30T10:00:00Z"

    Statement:
      type: object
      properties:
        cardId:
          type: string
          description: ID of the credit card
          example: "cc_123456789"
        periodStart:
          type: string
          format: date
          description: Start date of the billing period
          example: "2026-02-16"
        periodEnd:
          type: string
          format: date
          description: End date of the billing period
          example: "2026-03-15"
        dueDate:
          type: string
          format: date
          description: Due date of the statement
          example: "2026-03-22"
        transactions:
          type: array
          items:
            $ref: '#/components/schemas/Transaction'
          description: List of transactions in the statement period
        total:
          type: number
          format: float
          description: Total amount of the statement
          example: 3450.00
        availableLimit:
          type: number
          format: float
          description: Available credit limit
          example: 1550.00

    StatementStatus:
      type: object
      properties:
        cardId:
          type: string
          description: ID of the credit card
          example: "cc_123456789"
        month:
          type: string
          description: Month for the statement (YYYY-MM format)
          example: "2026-03"
        isPaid:
          type: boolean
          description: Whether all transactions in the statement are paid
          example: true

    Account:
      type: object
      required:
        - name
        - type
        - initialBalance
      properties:
        id:
          type: string
          description: Unique identifier for the account
          example: "acc_123456789"
        name:
          type: string
          description: Name of the account
          example: "Itaú Checking Account"
        type:
          type: string
          enum: [BANK_ACCOUNT, WALLET, SAVINGS_ACCOUNT, INVESTMENT_ACCOUNT, OTHER]
          description: Type of account
          example: "BANK_ACCOUNT"
        initialBalance:
          type: number
          format: float
          description: Initial balance when the account was created
          example: 1000.00
        currentBalance:
          type: number
          format: float
          description: Current balance of the account
          example: 850.00
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the account was created
          example: "2026-02-11T12:00:00Z"
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the account was last updated
          example: "2026-02-11T15:30:00Z"

    AccountBalance:
      type: object
      properties:
        accountId:
          type: string
          description: ID of the account
          example: "acc_123456789"
        currentBalance:
          type: number
          format: float
          description: Current balance of the account
          example: 850.00
        calculatedAt:
          type: string
          format: date-time
          description: Timestamp when the balance was calculated
          example: "2026-02-11T16:00:00Z"


    CategoryBreakdown:
      type: object
      properties:
        categoryId:
          type: string
          nullable: true
          description: Category ID (null if uncategorized)
          example: "cat-123"
        categoryName:
          type: string
          nullable: true
          description: Category name (null if uncategorized)
          example: "Housing"
        color:
          type: string
          nullable: true
          description: Category color in hex format
          example: "#ff5733"
        total:
          type: number
          format: float
          description: Total amount for this category
          example: 1500.00

    Summary:
      type: object
      properties:
        period:
          type: object
          description: The period covered by this summary
          properties:
            month:
              type: string
              description: Month in YYYY-MM format (present when queried by month)
              example: "2026-02"
            startDate:
              type: string
              description: Start date in YYYY-MM-DD format (present when queried by range)
              example: "2026-01-01"
            endDate:
              type: string
              description: End date in YYYY-MM-DD format (present when queried by range)
              example: "2026-03-31"
        income:
          type: number
          format: float
          description: Total income for the period (paid + pending)
          example: 10000.00
        expenses:
          type: number
          format: float
          description: Total expenses for the period (paid + pending)
          example: 4000.00
        pendingIncome:
          type: number
          format: float
          description: Sum of income transactions not yet marked as received
          example: 1000.00
        pendingExpenses:
          type: number
          format: float
          description: Sum of expense transactions not yet marked as paid
          example: 500.00
        balance:
          type: number
          format: float
          description: Net balance (income - expenses)
          example: 6000.00
        creditCardExpenses:
          type: array
          description: Credit card totals for the period
          items:
            type: object
            properties:
              cardId:
                type: string
                description: Credit card ID
                example: "abc-123"
              cardName:
                type: string
                description: Credit card name
                example: "Nubank"
              total:
                type: number
                format: float
                description: Total charged to this card in the period
                example: 2500.00
              dueDate:
                type: string
                format: date
                nullable: true
                description: Statement due date (only present when queried by month)
                example: "2026-03-22"
              isPaid:
                type: boolean
                nullable: true
                description: Whether the statement is fully paid (only present when queried by month)
                example: false
        expensesByCategory:
          type: array
          description: Expense totals grouped by category, sorted by total descending
          items:
            $ref: '#/components/schemas/CategoryBreakdown'
        incomeByCategory:
          type: array
          description: Income totals grouped by category, sorted by total descending
          items:
            $ref: '#/components/schemas/CategoryBreakdown'
        accounts:
          type: array
          description: >
            All accounts with their current balance (initialBalance + paid income - paid expenses).
            Not filtered by period.
          items:
            $ref: '#/components/schemas/AccountSummary'
        totalBalance:
          type: number
          format: float
          description: Sum of all account balances. Not filtered by period.
          example: 8500.00

    AccountSummary:
      type: object
      properties:
        accountId:
          type: string
          description: Account ID
          example: "acc-123"
        accountName:
          type: string
          description: Account name
          example: "Nubank"
        accountType:
          type: string
          enum: [BANK_ACCOUNT, WALLET, SAVINGS_ACCOUNT, INVESTMENT_ACCOUNT, OTHER]
          description: Account type
          example: "BANK_ACCOUNT"
        balance:
          type: number
          format: float
          description: Current balance (initialBalance + paid income - paid expenses)
          example: 2500.00

    CreateTransactionRequest:
      type: object
      required:
        - type
        - name
        - amount
        - date
      properties:
        type:
          $ref: '#/components/schemas/Transaction/properties/type'
        name:
          $ref: '#/components/schemas/Transaction/properties/name'
        amount:
          $ref: '#/components/schemas/Transaction/properties/amount'
        date:
          type: string
          format: date
          description: |
            Date of the transaction.
            For CREDIT payments, if targetDueMonth is provided, the date will be calculated based on the credit card's due day.
            Otherwise, this date will be used directly.
          example: "2026-01-30"
        categoryId:
          $ref: '#/components/schemas/Transaction/properties/categoryId'
        paymentMethod:
          $ref: '#/components/schemas/Transaction/properties/paymentMethod'
        creditCardId:
          $ref: '#/components/schemas/Transaction/properties/creditCardId'
        installments:
          type: integer
          minimum: 1
          description: Number of installments (optional)
          example: 3
        targetDueMonth:
          type: string
          pattern: "^\\d{4}-\\d{2}$"
          description: |
            Target month for due date in YYYY-MM format (optional).
            When provided for CREDIT payments, the transaction date(s) will be set to the credit card's due day in the specified month.
            For installments, each installment will be scheduled in subsequent months on the due day.
            Example: if credit card due day is 10, and targetDueMonth is "2026-03", the transaction date will be 2026-03-10.
          example: "2026-03"
        accountId:
          type: string
          description: ID of the associated account (required if paymentMethod is not CREDIT)
          example: "acc_123456789"
        recurrence:
          type: object
          properties:
            frequency:
              $ref: '#/components/schemas/RecurrenceRule/properties/frequency'
            interval:
              $ref: '#/components/schemas/RecurrenceRule/properties/interval'
            endDate:
              $ref: '#/components/schemas/RecurrenceRule/properties/endDate'
            occurrences:
              $ref: '#/components/schemas/RecurrenceRule/properties/occurrences'
        isPaid:
          type: boolean
          description: Whether the transaction is already paid at creation time (defaults to false)
          example: false
        purchaseDate:
          type: string
          format: date
          description: Actual purchase date (credit card only, optional)
          example: "2026-02-10"

    UpdateTransactionRequest:
      type: object
      properties:
        type:
          $ref: '#/components/schemas/Transaction/properties/type'
        name:
          $ref: '#/components/schemas/Transaction/properties/name'
        amount:
          $ref: '#/components/schemas/Transaction/properties/amount'
        date:
          type: string
          format: date
          description: |
            Date of the transaction.
            For CREDIT payments, if targetDueMonth is provided, the date will be calculated based on the credit card's due day.
            Otherwise, this date will be used directly.
          example: "2026-01-30"
        categoryId:
          $ref: '#/components/schemas/Transaction/properties/categoryId'
        paymentMethod:
          $ref: '#/components/schemas/Transaction/properties/paymentMethod'
        creditCardId:
          $ref: '#/components/schemas/Transaction/properties/creditCardId'
        targetDueMonth:
          type: string
          pattern: "^\\d{4}-\\d{2}$"
          description: |
            Target month for due date in YYYY-MM format (optional).
            When provided for CREDIT payments, the transaction date will be set to the credit card's due day in the specified month.
            Example: if credit card due day is 10, and targetDueMonth is "2026-03", the transaction date will be 2026-03-10.
          example: "2026-03"
        accountId:
          type: string
          description: ID of the associated account (required if paymentMethod is not CREDIT)
          example: "acc_123456789"
        recurrence:
          type: object
          properties:
            frequency:
              $ref: '#/components/schemas/RecurrenceRule/properties/frequency'
            interval:
              $ref: '#/components/schemas/RecurrenceRule/properties/interval'
            endDate:
              $ref: '#/components/schemas/RecurrenceRule/properties/endDate'
            occurrences:
              $ref: '#/components/schemas/RecurrenceRule/properties/occurrences'

    Settings:
      type: object
      required:
        - userName
        - language
        - currency
      properties:
        userName:
          type: string
          description: Name of the user
          example: "John Doe"
        language:
          type: string
          enum: [pt-BR, en-US]
          description: Preferred language
          example: "pt-BR"
        currency:
          type: string
          enum: [BRL, USD, EUR, GBP, JPY, CAD, AUD, CHF]
          description: Default currency
          example: "BRL"
        createdAt:
          type: string
          format: date-time
          description: Timestamp when settings were created
          example: "2026-01-30T10:00:00Z"
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when settings were last updated
          example: "2026-01-30T10:00:00Z"

  responses:
    UnauthorizedError:
      description: API key is missing or invalid
      content:
        application/json:
          schema:
            type: object
            properties:
              statusCode:
                type: integer
                example: 401
              error:
                type: string
                example: "Unauthorized"
              message:
                type: string
                example: "Invalid API key"

security:
  - ApiKeyAuth: []

paths:
  /categories:
    post:
      summary: Create a new category
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - type
              properties:
                name:
                  type: string
                  example: "Groceries"
                type:
                  type: string
                  enum: [INCOME, EXPENSE]
                  example: "EXPENSE"
                color:
                  type: string
                  nullable: true
                  pattern: "^#[0-9A-Fa-f]{6}$"
                  description: Color in hexadecimal format
                  example: "#FF5733"
      responses:
        '201':
          description: Category created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          description: Invalid input
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    get:
      summary: Get all categories
      responses:
        '200':
          description: List of categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /categories/{id}:
    get:
      summary: Get a category by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Category ID
      responses:
        '200':
          description: Category found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Category not found

    patch:
      summary: Update a category
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Category ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "Groceries"
                color:
                  type: string
                  nullable: true
                  pattern: "^#[0-9A-Fa-f]{6}$"
                  description: Color in hexadecimal format
                  example: "#FF5733"
      responses:
        '200':
          description: Category updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          description: Invalid input
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Category not found

    delete:
      summary: Delete a category
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Category ID
      responses:
        '200':
          description: Category deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Category not found

  /credit-cards:
    post:
      summary: Create a new credit card
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - limitAmount
                - closingDay
                - dueDay
              properties:
                name:
                  type: string
                  example: "Nubank Platinum"
                brand:
                  type: string
                  example: "Visa"
                limitAmount:
                  type: number
                  format: float
                  example: 5000.00
                closingDay:
                  type: integer
                  minimum: 1
                  maximum: 31
                  example: 15
                dueDay:
                  type: integer
                  minimum: 1
                  maximum: 31
                  example: 22
      responses:
        '201':
          description: Credit card created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreditCard'
        '400':
          description: Invalid input
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    get:
      summary: Get all credit cards
      responses:
        '200':
          description: List of credit cards
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CreditCard'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /credit-cards/{id}:
    get:
      summary: Get a credit card by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Credit card ID
      responses:
        '200':
          description: Credit card found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreditCard'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Credit card not found

    patch:
      summary: Update a credit card
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Credit card ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "Nubank Platinum"
                brand:
                  type: string
                  example: "Visa"
                limitAmount:
                  type: number
                  format: float
                  example: 5000.00
                closingDay:
                  type: integer
                  minimum: 1
                  maximum: 31
                  example: 15
                dueDay:
                  type: integer
                  minimum: 1
                  maximum: 31
                  example: 22
      responses:
        '200':
          description: Credit card updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreditCard'
        '400':
          description: Invalid input
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Credit card not found

    delete:
      summary: Delete a credit card
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Credit card ID
      responses:
        '200':
          description: Credit card deleted successfully
        '400':
          description: Cannot delete credit card with associated transactions
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Credit card not found

  /credit-cards/{id}/statement:
    get:
      summary: Get credit card statement for a specific month
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Credit card ID
        - name: month
          in: query
          required: true
          schema:
            type: string
            pattern: "^\\d{4}-\\d{2}$"
          description: Month in YYYY-MM format
          example: "2026-03"
      responses:
        '200':
          description: Credit card statement
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Statement'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Credit card not found

  /credit-cards/{id}/pay-statement:
    post:
      summary: Mark all transactions in a credit card statement as paid
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Credit card ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - month
                - paymentAccountId
              properties:
                month:
                  type: string
                  pattern: "^\\d{4}-\\d{2}$"
                  description: Month in YYYY-MM format
                  example: "2026-03"
                paymentAccountId:
                  type: string
                  description: ID of the account to debit for the payment
                  example: "acc_123456789"
      responses:
        '200':
          description: Statement marked as paid
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Statement for March 2026 marked as paid and linked to account acc_123456789"
        '400':
          description: Invalid input or statement is already paid
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Credit card not found

  /credit-cards/{id}/reopen-statement:
    post:
      summary: Reopen a credit card statement by marking all transactions as unpaid
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Credit card ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - month
              properties:
                month:
                  type: string
                  pattern: "^\\d{4}-\\d{2}$"
                  description: Month in YYYY-MM format
                  example: "2026-03"
      responses:
        '200':
          description: Statement reopened successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Statement for 2026-03 successfully reopened. 5 transaction(s) marked as unpaid."
        '400':
          description: Invalid input or statement is already open
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Credit card not found

  /credit-cards/{id}/statement-status:
    get:
      summary: Get credit card statement payment status for a specific month
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Credit card ID
        - name: month
          in: query
          required: true
          schema:
            type: string
            pattern: "^\\d{4}-\\d{2}$"
          description: Month in YYYY-MM format
          example: "2026-03"
      responses:
        '200':
          description: Credit card statement status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatementStatus'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Credit card not found

  /transactions:
    post:
      summary: Create a new transaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - type
                - name
                - amount
                - date
              properties:
                type:
                  $ref: '#/components/schemas/Transaction/properties/type'
                name:
                  $ref: '#/components/schemas/Transaction/properties/name'
                amount:
                  $ref: '#/components/schemas/Transaction/properties/amount'
                date:
                  $ref: '#/components/schemas/Transaction/properties/date'
                categoryId:
                  $ref: '#/components/schemas/Transaction/properties/categoryId'
                paymentMethod:
                  $ref: '#/components/schemas/Transaction/properties/paymentMethod'
                creditCardId:
                  $ref: '#/components/schemas/Transaction/properties/creditCardId'
                accountId:
                  type: string
                  description: ID of the associated account (required if paymentMethod is not CREDIT)
                  example: "acc_123456789"
                installments:
                  type: integer
                  minimum: 1
                  description: Number of installments (optional)
                  example: 3
                targetDueMonth:
                  type: string
                  pattern: "^\\d{4}-\\d{2}$"
                  description: Target month for due date in YYYY-MM format (optional)
                  example: "2026-03"
                purchaseDate:
                  type: string
                  format: date
                  description: Actual purchase date (credit card only, optional)
                  example: "2026-02-10"
                recurrence:
                  type: object
                  properties:
                    frequency:
                      $ref: '#/components/schemas/RecurrenceRule/properties/frequency'
                    interval:
                      $ref: '#/components/schemas/RecurrenceRule/properties/interval'
                    endDate:
                      $ref: '#/components/schemas/RecurrenceRule/properties/endDate'
                    occurrences:
                      $ref: '#/components/schemas/RecurrenceRule/properties/occurrences'
      responses:
        '201':
          description: Transaction created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '400':
          description: Invalid input or target statement is already closed (paid)
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    get:
      summary: Get all transactions
      parameters:
        - name: month
          in: query
          required: false
          schema:
            type: string
            pattern: "^\\d{4}-\\d{2}$"
          description: Filter transactions by month (YYYY-MM format)
          example: "2026-03"
        - name: accountId
          in: query
          required: false
          schema:
            type: string
          description: Filter transactions by account ID
          example: "acc_123456789"
        - name: categoryId
          in: query
          required: false
          schema:
            type: string
          description: Filter transactions by category ID
          example: "cat_123456789"
        - name: creditCardId
          in: query
          required: false
          schema:
            type: string
          description: Filter transactions by credit card ID
          example: "cc_123456789"
        - name: type
          in: query
          required: false
          schema:
            type: string
            enum: [INCOME, EXPENSE]
          description: Filter transactions by type
          example: "EXPENSE"
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: Filter transactions starting from this date (inclusive)
          example: "2026-01-01"
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: Filter transactions up to this date (inclusive)
          example: "2026-01-31"
        - name: paid
          in: query
          required: false
          schema:
            type: boolean
          description: Filter by payment status (true = paid, false = unpaid)
          example: false
      responses:
        '200':
          description: List of transactions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Transaction'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /transactions/{id}/pay:
    patch:
      summary: Mark a transaction as paid/received
      description: |
        Marks a transaction as paid or received.
        **Note:** Credit card transactions cannot be marked as paid directly. They are automatically
        marked as paid when the credit card statement is paid via the `POST /credit-cards/{id}/pay-statement` endpoint.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Transaction ID
      responses:
        '200':
          description: Transaction marked as paid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '400':
          description: Cannot mark credit card transaction as paid directly
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Transaction not found

  /transactions/{id}/unpay:
    patch:
      summary: Mark a transaction as unpaid
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Transaction ID
      responses:
        '200':
          description: Transaction marked as unpaid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '404':
          description: Transaction not found
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /transactions/{id}:
    get:
      summary: Get a transaction by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Transaction ID
      responses:
        '200':
          description: Transaction found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Transaction not found

    patch:
      summary: Update a transaction
      description: |
        Update a transaction.
        **Note:** Transactions that have already been paid cannot be edited.
        For credit card transactions, you can use targetDueMonth to automatically calculate the date based on the credit card's due day.

        **Recurring Transactions - Editable Fields by Mode:**
        - **SINGLE**: Can edit `name`, `categoryId`, `date`, `targetDueMonth`, `amount`
        - **PENDING/ALL**: Can edit `name`, `categoryId`, `amount`, `paymentMethod`, `accountId`, `creditCardId` (date and type are restricted to prevent desynchronization)

        **Installment Transactions - Editable Fields by Mode:**
        - **PENDING/ALL**: Only `name`, `categoryId`, and `amount` are propagated to other installments. All other fields are ignored for the bulk update.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Transaction ID
        - name: mode
          in: query
          required: false
          schema:
            type: string
            enum: [SINGLE, PENDING, ALL]
            default: SINGLE
          description: |
            Update mode for recurring or installment transactions:
            - **SINGLE**: Update only this specific transaction (default)
            - **PENDING**: Update this transaction and all future unpaid transactions in the same recurrence series or installment group
            - **ALL**: For recurrences, update all transactions (paid or unpaid). For installments, behaves the same as PENDING (only unpaid installments from this one onward are updated)

            If the transaction is not part of a recurrence series or installment group, this parameter is ignored.
          example: SINGLE
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTransactionRequest'
      responses:
        '200':
          description: Transaction updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '400':
          description: Invalid input or transaction is already paid
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Transaction not found

    delete:
      summary: Delete a transaction
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Transaction ID
        - name: mode
          in: query
          required: false
          schema:
            type: string
            enum: [SINGLE, PENDING, ALL]
            default: SINGLE
          description: |
            Deletion mode for recurring or installment transactions:
            - **SINGLE**: Delete only this specific transaction (default)
            - **PENDING**: Delete this transaction and all future unpaid transactions in the same recurrence series or installment group
            - **ALL**: For recurrences, delete all transactions (paid or unpaid). For installments, behaves the same as PENDING (only unpaid installments from this one onward are deleted)

            If the transaction is not part of a recurrence series or installment group, this parameter is ignored.
          example: SINGLE
      responses:
        '200':
          description: Transaction deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Transaction not found

  /summary:
    get:
      summary: Get financial summary
      description: >
        Returns income, expenses, balance, credit card totals, and category breakdowns.
        Provide either `month` (YYYY-MM) or both `startDate` and `endDate` (YYYY-MM-DD).
      parameters:
        - name: month
          in: query
          required: false
          schema:
            type: string
            pattern: "^\\d{4}-\\d{2}$"
          description: Month in YYYY-MM format
          example: "2026-02"
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            pattern: "^\\d{4}-\\d{2}-\\d{2}$"
          description: Start date in YYYY-MM-DD format (use with endDate for a custom range)
          example: "2026-01-01"
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            pattern: "^\\d{4}-\\d{2}-\\d{2}$"
          description: End date in YYYY-MM-DD format (use with startDate for a custom range)
          example: "2026-03-31"
      responses:
        '200':
          description: Financial summary for the given period
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Summary'
        '400':
          description: Invalid or missing period parameters
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /accounts:
    post:
      summary: Create a new account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - type
              properties:
                name:
                  type: string
                  description: Name of the account
                  example: "Itaú Checking Account"
                type:
                  type: string
                  enum: [BANK_ACCOUNT, WALLET, SAVINGS_ACCOUNT, INVESTMENT_ACCOUNT, OTHER]
                  description: Type of account
                  example: "BANK_ACCOUNT"
                initialBalance:
                  type: number
                  format: float
                  description: Initial balance for the account
                  example: 1000.00
      responses:
        '201':
          description: Account created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        '400':
          description: Invalid input
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    get:
      summary: Get all accounts
      responses:
        '200':
          description: List of accounts with current balances
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Account'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /accounts/{id}:
    get:
      summary: Get a specific account
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Account ID
      responses:
        '200':
          description: Account details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Account not found

    patch:
      summary: Update an account
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Account ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: Name of the account
                  example: "Itaú Savings Account"
                type:
                  type: string
                  enum: [BANK_ACCOUNT, WALLET, SAVINGS_ACCOUNT, INVESTMENT_ACCOUNT, OTHER]
                  description: Type of account
                  example: "SAVINGS_ACCOUNT"
      responses:
        '200':
          description: Account updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        '400':
          description: Invalid input
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Account not found

    delete:
      summary: Delete an account
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Account ID
      responses:
        '204':
          description: Account deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Account not found
        '409':
          description: Cannot delete account with associated transactions

  /accounts/{id}/balance:
    get:
      summary: Get the current balance for an account
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Account ID
      responses:
        '200':
          description: Account balance
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountBalance'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Account not found

  /accounts/{id}/transactions:
    get:
      summary: Get all transactions linked to an account
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Account ID
      responses:
        '200':
          description: List of transactions linked to the account
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Transaction'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Account not found

  /export:
    get:
      summary: Export all user data
      description: Returns a complete backup of all user data including settings, categories, accounts, credit cards, recurrence rules, and transactions.
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Export payload with all data
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: string
                    example: "1.0"
                  exportedAt:
                    type: string
                    format: date-time
                    example: "2026-02-14T21:00:00.000Z"
                  data:
                    type: object
                    properties:
                      settings:
                        nullable: true
                        $ref: '#/components/schemas/Settings'
                      categories:
                        type: array
                        items:
                          $ref: '#/components/schemas/Category'
                      accounts:
                        type: array
                        items:
                          $ref: '#/components/schemas/Account'
                      creditCards:
                        type: array
                        items:
                          $ref: '#/components/schemas/CreditCard'
                      recurrenceRules:
                        type: array
                        items:
                          $ref: '#/components/schemas/RecurrenceRule'
                      transactions:
                        type: array
                        items:
                          $ref: '#/components/schemas/Transaction'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /import:
    post:
      summary: Import user data
      description: |
        Imports a previously exported backup. Supports two modes:
        - **reset**: Clears all existing data and replaces it with the imported data.
        - **increment**: Adds new records from the import, ignoring records whose IDs already exist.
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - mode
                - version
                - exportedAt
                - data
              properties:
                mode:
                  type: string
                  enum: [reset, increment]
                  description: Import mode
                  example: "reset"
                version:
                  type: string
                  description: Export format version. Must be "1.0".
                  example: "1.0"
                exportedAt:
                  type: string
                  format: date-time
                  example: "2026-02-14T21:00:00.000Z"
                data:
                  type: object
                  properties:
                    settings:
                      nullable: true
                      $ref: '#/components/schemas/Settings'
                    categories:
                      type: array
                      items:
                        $ref: '#/components/schemas/Category'
                    accounts:
                      type: array
                      items:
                        $ref: '#/components/schemas/Account'
                    creditCards:
                      type: array
                      items:
                        $ref: '#/components/schemas/CreditCard'
                    recurrenceRules:
                      type: array
                      items:
                        $ref: '#/components/schemas/RecurrenceRule'
                    transactions:
                      type: array
                      items:
                        $ref: '#/components/schemas/Transaction'
      responses:
        '200':
          description: Import completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Import completed successfully (mode: reset)"
        '400':
          description: Invalid input or unsupported version
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /settings:
    post:
      summary: Create global settings (only if not exists)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userName
                - language
                - currency
              properties:
                userName:
                  type: string
                  example: "John Doe"
                language:
                  type: string
                  enum: [pt-BR, en-US]
                  example: "pt-BR"
                currency:
                  type: string
                  enum: [BRL, USD, EUR, GBP, JPY, CAD, AUD, CHF]
                  example: "BRL"
      responses:
        '201':
          description: Settings created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Settings'
        '400':
          description: Invalid input
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '409':
          description: Settings already exist

    get:
      summary: Get global settings
      responses:
        '200':
          description: Settings retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Settings'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Settings not found

    put:
      summary: Update global settings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userName:
                  type: string
                  example: "John Doe"
                language:
                  type: string
                  enum: [pt-BR, en-US]
                  example: "pt-BR"
                currency:
                  type: string
                  enum: [BRL, USD, EUR, GBP, JPY, CAD, AUD, CHF]
                  example: "BRL"
      responses:
        '200':
          description: Settings updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Settings'
        '400':
          description: Invalid input
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Settings not found

